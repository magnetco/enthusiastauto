<story-context id="bmad/bmm/workflows/4-implementation/story-context/template" v="1.0">
  <metadata>
    <epicId>10</epicId>
    <storyId>10.2</storyId>
    <title>Typography System Consistency</title>
    <status>Ready</status>
    <generatedAt>2025-10-29</generatedAt>
    <generator>BMAD Story Context Workflow</generator>
    <sourceStoryPath>docs/stories/story-10.2.md</sourceStoryPath>
  </metadata>

  <story>
    <asA>user browsing the site</asA>
    <iWant>consistent typography hierarchy across all pages</iWant>
    <soThat>content is easier to read and the site feels cohesive</soThat>
    <tasks>
      - Task 1: Resolve Font Family Decision (AC: #3, #8)
      - Task 2: Remove Global Uppercase Transform (AC: #4, #5)
      - Task 3: Create Typography Token Utility Classes (AC: #1, #6)
      - Task 4: Audit All Pages for Typography Consistency (AC: #1, #2, #5)
      - Task 5: Fix Tailwind Arbitrary Classes (AC: #1)
      - Task 6: Test Typography Responsive Behavior (AC: #7)
      - Task 7: Verify Line-Height and Letter-Spacing (AC: #6)
      - Task 8: Update Documentation (AC: #8)
    </tasks>
  </story>

  <acceptanceCriteria>
    1. All headings (h1-h6) consistently use design token font sizes, weights, and letter-spacing
    2. All body text uses base typography tokens consistently
    3. Font family consistency verified: either all Figtree OR migrated to Inter/Outfit per docs
    4. Evaluate and standardize text-transform: uppercase on headings (keep or remove)
    5. Fix typography hierarchy issues identified in Story 10.1
    6. Ensure line-height and letter-spacing tokens applied across all text
    7. Mobile and desktop typography scales tested and verified
    8. Update design-system.md with finalized typography decisions
  </acceptanceCriteria>

  <artifacts>
    <docs>
      <doc>
        <path>app/globals.css</path>
        <title>Main Typography System Definitions</title>
        <section>Typography Tokens (lines 110-175)</section>
        <snippet>Complete Linear-inspired typography scale with 11 font sizes (micro 11px to hero 48px), each with paired line-height and letter-spacing. Base font: Figtree variable (300-700). Defines --font-size-base: 14px with 1.57 line-height and -0.006em letter-spacing.</snippet>
      </doc>
      <doc>
        <path>app/globals.css</path>
        <title>Global Heading Styles</title>
        <section>Heading Typography (lines 328-375)</section>
        <snippet>CRITICAL: Line 335 applies text-transform: uppercase to ALL headings (h1-h6) globally. Heading sizes: h1 32pxâ†’48px responsive, h2 24px, h3 20px, h4 16px, h5/h6 14px. All use var(--font-sans) and medium/semibold weights.</snippet>
      </doc>
      <doc>
        <path>docs/design-system.md</path>
        <title>Typography Documentation</title>
        <section>Typography Section (lines 69-126)</section>
        <snippet>Documents Figtree as font family (updated in Story 10.1), typography scale table, font weights 300-700. Lines 114-116 note uppercase transform is applied globally and recommend making it optional. Includes usage examples and best practices.</snippet>
      </doc>
      <doc>
        <path>docs/design-system-audit-2025-10-28.md</path>
        <title>Typography Audit Findings</title>
        <section>Section 8: Font Family Decision (lines 795-880)</section>
        <snippet>Decision: KEEP Figtree (already implemented). Rationale: no user benefit to switch, performance cost of loading Inter+Outfit, risk avoidance. Section 8.3 recommends removing global uppercase transform (line 335) and creating .heading-uppercase utility class for selective use.</snippet>
      </doc>
      <doc>
        <path>docs/design-system-audit-2025-10-28.md</path>
        <title>Story 10.2 Recommendations</title>
        <section>Section 9.1: Typography System Consistency (lines 885-904)</section>
        <snippet>Recommended fixes: Remove text-transform: uppercase (globals.css line 335), create .heading-uppercase utility, update design-system.md font family to Figtree, document typography token usage patterns, consider creating custom Tailwind classes mapping to typography tokens (e.g., .text-title-1, .text-title-2).</snippet>
      </doc>
      <doc>
        <path>docs/epic-stories.md</path>
        <title>Epic 10 Story Definitions</title>
        <section>Story 10.2 (lines 1093-1120)</section>
        <snippet>Story 10.2 definition with 5 points. Focus: Consistent typography hierarchy, design token font sizes/weights/letter-spacing, font family validation, text-transform uppercase evaluation, mobile/desktop typography testing. Prerequisites: Story 10.1 complete. Related to NFR011 Typography hierarchy.</snippet>
      </doc>
    </docs>
    <code>
      <artifact>
        <path>app/page.tsx</path>
        <kind>page</kind>
        <symbol>Homepage</symbol>
        <lines>43-44, 61-62</lines>
        <reason>H2 headings use text-3xl font-bold text-foreground sm:text-4xl - Tailwind arbitrary classes instead of typography tokens. Needs audit for consistency.</reason>
      </artifact>
      <artifact>
        <path>app/services/page.tsx</path>
        <kind>page</kind>
        <symbol>ServicesPage (Gold Standard)</symbol>
        <lines>38-39, 52-53, 73, 80, 85</lines>
        <reason>GOLD STANDARD for typography usage. Headings: text-3xl font-bold text-foreground sm:text-4xl. Body: text-lg text-muted-foreground. Small: text-sm text-muted-foreground. Perfect semantic token usage throughout. Use as reference.</reason>
      </artifact>
      <artifact>
        <path>app/vehicles/page.tsx</path>
        <kind>page</kind>
        <symbol>VehiclesListingPage</symbol>
        <lines>80-85, 114</lines>
        <reason>Title uses text-3xl font-bold text-foreground sm:text-4xl. Description and item count use text-muted-foreground. Good semantic usage but arbitrary Tailwind sizes.</reason>
      </artifact>
      <artifact>
        <path>app/search/page.tsx</path>
        <kind>page</kind>
        <symbol>SearchPage</symbol>
        <lines>20-22</lines>
        <reason>Minimal page file, delegates to SearchResults component. Clean implementation with no typography issues at page level.</reason>
      </artifact>
      <artifact>
        <path>app/account/profile/page.tsx</path>
        <kind>page</kind>
        <symbol>ProfilePage</symbol>
        <lines>82-100, 96, 97, 110, 124, 127, 135, 143</lines>
        <reason>Page title: text-3xl font-bold. User info heading: text-xl font-semibold. Small text: text-sm text-muted-foreground. Mostly good but minimal explicit typography configuration. Uses semantic tokens after Story 10.3 fixes.</reason>
      </artifact>
      <artifact>
        <path>app/account/garage/GarageContent.tsx</path>
        <kind>component</kind>
        <symbol>GarageContent</symbol>
        <lines>124-134, 267</lines>
        <reason>Title: text-3xl font-bold text-foreground. Subtitle: text-sm text-muted-foreground. Empty state: text-xl font-semibold text-foreground. Good semantic typography usage.</reason>
      </artifact>
      <artifact>
        <path>components/shared/HeroSection.tsx</path>
        <kind>component</kind>
        <symbol>HeroSection</symbol>
        <lines>24-34</lines>
        <reason>H1: text-4xl font-bold leading-tight text-foreground sm:text-5xl lg:text-6xl (responsive typography). Subheadline: text-lg text-muted-foreground sm:text-xl lg:text-2xl. Uses multiple responsive breakpoints - should follow consistent pattern.</reason>
      </artifact>
      <artifact>
        <path>components/shared/FeaturedVehicles.tsx</path>
        <kind>component</kind>
        <symbol>FeaturedVehicles</symbol>
        <lines>24-32</lines>
        <reason>Section heading: text-3xl font-bold text-foreground sm:text-4xl. Description: text-base text-muted-foreground sm:text-lg. Good responsive typography with 2-size pattern (simpler than HeroSection's 3-size pattern).</reason>
      </artifact>
      <artifact>
        <path>components/vehicles/VehicleCard.tsx</path>
        <kind>component</kind>
        <symbol>VehicleCard</symbol>
        <lines>67, 75, 83, 86</lines>
        <reason>Title: text-lg font-semibold text-foreground group-hover:text-primary. Chassis: text-xs text-muted-foreground. Price: font-semibold text-primary. Mileage: text-muted-foreground. All semantic tokens after Story 10.3 fixes.</reason>
      </artifact>
    </code>
    <dependencies>
      <node>
        <framework>Next.js 15.3.0-canary.13</framework>
        <framework>React 19.0.0</framework>
        <framework>TypeScript 5.8.2</framework>
        <styling>tailwindcss 4.0.14</styling>
        <styling>@tailwindcss/typography 0.5.16</styling>
        <styling>@tailwindcss/postcss 4.0.14</styling>
        <styling>postcss 8.5.3</styling>
        <fonts>geist 1.3.1 (alternative font system)</fonts>
        <ui>@radix-ui/* (various radix-ui components)</ui>
        <testing>vitest 4.0.1</testing>
        <testing>@testing-library/react 16.3.0</testing>
        <testing>@playwright/test 1.56.0</testing>
      </node>
    </dependencies>
  </artifacts>

  <constraints>
    <constraint>
      <rule>Typography System: All typography must use design tokens defined in app/globals.css (lines 110-175)</rule>
      <source>docs/design-system.md, app/globals.css</source>
    </constraint>
    <constraint>
      <rule>Font Family: Must use Figtree (variable font, 300-700 weights) with system fallback stack: -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif</rule>
      <source>Story 10.1 decision, docs/design-system-audit-2025-10-28.md Section 8.2</source>
    </constraint>
    <constraint>
      <rule>Semantic Color Tokens: Always use text-foreground, text-muted-foreground, text-primary (never hardcoded colors)</rule>
      <source>Story 10.3 fixes, docs/design-system.md</source>
    </constraint>
    <constraint>
      <rule>Line Height and Letter Spacing: Must use paired values from design tokens (e.g., 14px base = 1.57 line-height + -0.006em letter-spacing)</rule>
      <source>app/globals.css lines 110-175</source>
    </constraint>
    <constraint>
      <rule>Uppercase Transform: Global text-transform: uppercase on line 335 must be removed and replaced with selective .heading-uppercase utility class</rule>
      <source>docs/design-system-audit-2025-10-28.md Section 8.3, Story 10.2 Task 2</source>
    </constraint>
    <constraint>
      <rule>Responsive Typography: Consistent pattern required across all components (recommend 2-size pattern: base sm:larger, avoid 3+ size patterns unless hero)</rule>
      <source>Analysis of HeroSection vs FeaturedVehicles patterns</source>
    </constraint>
    <constraint>
      <rule>Next.js 15 App Router: All pages in app/ directory, use Server Components by default, Client Components marked with "use client"</rule>
      <source>Project structure</source>
    </constraint>
    <constraint>
      <rule>Tailwind CSS 4.0: Using modern Tailwind v4 with @tailwindcss/postcss. Custom utilities should be added to globals.css using @layer utilities</rule>
      <source>package.json devDependencies</source>
    </constraint>
    <constraint>
      <rule>Testing: Vitest for unit/component tests, Playwright for E2E, @testing-library/react for component testing</rule>
      <source>package.json devDependencies, dev-story workflow pattern</source>
    </constraint>
  </constraints>

  <interfaces>
    <interface>
      <name>Typography CSS Custom Properties API</name>
      <kind>CSS Variables</kind>
      <signature>
        --font-sans: var(--font-figtree), "Figtree", -apple-system, ...
        --font-mono: ui-monospace, "SF Mono", ...
        --font-weight-light: 300
        --font-weight-normal: 400
        --font-weight-medium: 500
        --font-weight-semibold: 600
        --font-weight-bold: 700
        --font-size-micro: 11px (--line-height-micro: 1.45, --letter-spacing-micro: 0.01em)
        --font-size-mini: 12px (--line-height-mini: 1.5, --letter-spacing-mini: 0)
        --font-size-small: 13px (--line-height-small: 1.54, --letter-spacing-small: -0.003em)
        --font-size-base: 14px (--line-height-base: 1.57, --letter-spacing-base: -0.006em)
        --font-size-regular: 15px (--line-height-regular: 1.6, --letter-spacing-regular: -0.009em)
        --font-size-large: 16px (--line-height-large: 1.5, --letter-spacing-large: -0.011em)
        --font-size-xl: 18px (--line-height-xl: 1.44, --letter-spacing-xl: -0.014em)
        --font-size-title-3: 20px (--line-height-title-3: 1.4, --letter-spacing-title-3: -0.017em)
        --font-size-title-2: 24px (--line-height-title-2: 1.33, --letter-spacing-title-2: -0.019em)
        --font-size-title-1: 32px (--line-height-title-1: 1.25, --letter-spacing-title-1: -0.022em)
        --font-size-hero: 48px (--line-height-hero: 1.17, --letter-spacing-hero: -0.028em)
      </signature>
      <path>app/globals.css</path>
      <notes>All typography tokens are defined with paired line-height and letter-spacing values for optimal readability. Access via var(--token-name) in CSS or create Tailwind utility classes</notes>
    </interface>
    <interface>
      <name>Tailwind Semantic Color Classes</name>
      <kind>CSS Utility Classes</kind>
      <signature>
        text-foreground (primary text, high contrast)
        text-muted-foreground (secondary text, medium contrast)
        text-primary (brand color for links/CTAs)
        text-secondary (alternative secondary text)
        bg-background (main background)
        bg-card (elevated surfaces)
      </signature>
      <path>app/globals.css (ShadCN theme configuration)</path>
      <notes>Semantic tokens automatically adapt to light/dark themes. Always use these instead of hardcoded colors or gray-* classes</notes>
    </interface>
    <interface>
      <name>Heading Element Defaults</name>
      <kind>Global CSS Selectors</kind>
      <signature>
        h1 { font-size: var(--font-size-title-1); line-height: var(--line-height-title-1); font-weight: var(--font-weight-medium); text-transform: uppercase; }
        h2 { font-size: var(--font-size-title-2); line-height: var(--line-height-title-2); font-weight: var(--font-weight-semibold); text-transform: uppercase; }
        h3 { font-size: var(--font-size-title-3); line-height: var(--line-height-title-3); font-weight: var(--font-weight-semibold); text-transform: uppercase; }
        h4, h5, h6 { ... text-transform: uppercase; }
        @media (min-width: 640px) { h1 { font-size: var(--font-size-hero); } }
      </signature>
      <path>app/globals.css lines 328-375</path>
      <notes>CRITICAL: Line 335 applies text-transform: uppercase globally to ALL headings. This is the main issue for Story 10.2 Task 2.</notes>
    </interface>
  </interfaces>

  <tests>
    <standards>
      Project uses Vitest for unit/component testing with @testing-library/react, and Playwright for E2E testing. Test files are co-located in __tests__ directories or use .test.ts/.test.tsx suffix. Typography testing should verify: (1) correct semantic token usage in components, (2) responsive font size rendering at different breakpoints, (3) line-height and letter-spacing application, (4) uppercase transform applied only where intended. Visual regression tests via Playwright can capture typography rendering across themes and viewports. No dedicated typography tests exist yet - Story 10.2 should establish baseline tests for heading hierarchy and responsive typography behavior.
    </standards>
    <locations>
      __tests__/ directories
      *.test.ts, *.test.tsx files
      playwright.config.ts for E2E configuration
      vitest.config.ts for unit test configuration
    </locations>
    <ideas>
      <idea>
        <testId>TYP-001</testId>
        <description>Typography Token Verification Test</description>
        <approach>Unit test to verify typography CSS custom properties are defined and match documented values. Check --font-size-base, --font-size-title-1, --font-size-hero, etc.</approach>
        <coversCriteria>AC1, AC6</coversCriteria>
      </idea>
      <idea>
        <testId>TYP-002</testId>
        <description>Heading Uppercase Removal Test</description>
        <approach>After removing line 335, verify h1-h6 elements do NOT have text-transform: uppercase by default. Test that .heading-uppercase utility class applies uppercase when explicitly added.</approach>
        <coversCriteria>AC4, AC5</coversCriteria>
      </idea>
      <idea>
        <testId>TYP-003</testId>
        <description>Responsive Typography Test</description>
        <approach>Playwright test to capture typography rendering at 320px, 640px, 1024px, 1920px viewports. Verify h1 grows from 32px to 48px at sm breakpoint. Check all pages maintain readable typography at all sizes.</approach>
        <coversCriteria>AC7</coversCriteria>
      </idea>
      <idea>
        <testId>TYP-004</testId>
        <description>Font Family Consistency Test</description>
        <approach>Unit test to verify all text elements use Figtree font with correct fallback stack. No Inter or Outfit fonts should be loaded. Check computed font-family on various elements.</approach>
        <coversCriteria>AC3</coversCriteria>
      </idea>
      <idea>
        <testId>TYP-005</testId>
        <description>Line-Height and Letter-Spacing Test</description>
        <approach>Unit test to verify paired typography values are applied correctly. For --font-size-base (14px), verify line-height is 1.57 and letter-spacing is -0.006em. Test across all typography tokens.</approach>
        <coversCriteria>AC6</coversCriteria>
      </idea>
      <idea>
        <testId>TYP-006</testId>
        <description>Semantic Token Usage Test</description>
        <approach>Component tests for all audited pages (homepage, services, vehicles, profile, garage) to verify no hardcoded font sizes. All text should use either semantic Tailwind classes or typography tokens.</approach>
        <coversCriteria>AC1, AC2</coversCriteria>
      </idea>
      <idea>
        <testId>TYP-007</testId>
        <description>Visual Regression Test</description>
        <approach>Playwright screenshot comparison test for typography changes. Capture before/after removing uppercase transform. Verify readability improvements on long headings while maintaining style on short, impactful headings.</approach>
        <coversCriteria>AC4, AC5, AC7</coversCriteria>
      </idea>
    </ideas>
  </tests>
</story-context>
