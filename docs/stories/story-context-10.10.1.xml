<story-context id="bmad/bmm/workflows/4-implementation/story-context/template" v="1.0">
  <metadata>
    <epicId>10</epicId>
    <storyId>10.1</storyId>
    <title>Design System Audit & Documentation Sync</title>
    <status>Ready</status>
    <generatedAt>2025-10-28</generatedAt>
    <generator>BMAD Story Context Workflow</generator>
    <sourceStoryPath>docs/stories/story-10.1.md</sourceStoryPath>
  </metadata>

  <story>
    <asA>a developer maintaining the design system</asA>
    <iWant>to audit all pages and synchronize design-system.md with the actual implementation</iWant>
    <soThat>we have a single source of truth for design decisions</soThat>
    <tasks>
      <task id="1" acs="1,2">Audit all pages for design token usage (/, /products, /vehicles, /search, /account/profile, /account/garage, /services) - document typography, colors, spacing</task>
      <task id="2" acs="3">Conduct WCAG accessibility audit - test all text/background combinations for 4.5:1 contrast, UI components for 3:1 contrast, document profile/garage CRITICAL issues</task>
      <task id="3" acs="2,4">Audit globals.css @theme tokens - document all CSS custom properties, check usage, identify unused tokens and hardcoded values</task>
      <task id="4" acs="4,5">Compare design-system.md vs implementation - resolve font family decision (Figtree vs Inter/Outfit), compare color palettes and spacing systems</task>
      <task id="5" acs="6">Create design token usage inventory matrix - pages (rows) × design tokens (columns), mark correct usage and identify drift</task>
      <task id="6" acs="7">Document specific known inconsistencies - parts vs vehicle cards, profile/garage color conflicts (CRITICAL), search layout, parts display section</task>
      <task id="7" acs="5">Update design-system.md - synchronize typography, color palette, spacing system, elevation/shadow tokens with actual implementation</task>
      <task id="8" acs="8">Provide recommendations for Stories 10.2-10.5 - list specific fixes needed with effort estimates and prioritization</task>
    </tasks>
  </story>

  <acceptanceCriteria>
    <criterion id="1">Complete page-by-page audit documenting typography, color, spacing usage across all pages (/, /products, /vehicles, /search, /account/profile, /account/garage, /services)</criterion>
    <criterion id="2">Identify all design token inconsistencies across pages with specific examples</criterion>
    <criterion id="3">Document all accessibility violations (contrast, color conflicts) with WCAG compliance ratings</criterion>
    <criterion id="4">Reconcile design-system.md with globals.css implementation (decide: keep Figtree or switch to Inter/Outfit?)</criterion>
    <criterion id="5">Update design-system.md to match chosen implementation with accurate token documentation</criterion>
    <criterion id="6">Create design token usage inventory matrix showing which pages use which tokens</criterion>
    <criterion id="7">Document specific inconsistencies found: parts cards vs vehicle cards, profile/garage bg issues, search layout, parts display extra section</criterion>
    <criterion id="8">Provide actionable recommendations for Stories 10.2-10.5 with estimated effort for each fix</criterion>
  </acceptanceCriteria>

  <artifacts>
    <docs>
      <doc>
        <path>docs/PRD.md</path>
        <title>Product Requirements Document</title>
        <section>FR025 &amp; NFR011: Design System &amp; Accessibility</section>
        <snippet>FR025: Platform shall implement cohesive design system with consistent typography, colors, spacing across all pages. NFR011: All pages shall meet WCAG 2.1 AA standards (4.5:1 text contrast, 3:1 UI components), visible focus indicators, keyboard navigation support.</snippet>
      </doc>
      <doc>
        <path>docs/epic-stories.md</path>
        <title>Epic Stories Documentation</title>
        <section>Epic 10: Design System Unification</section>
        <snippet>Goal: Establish cohesive, accessible, production-ready design system. Priority: HIGH - blocking production readiness. Success: All pages use consistent tokens, WCAG AA compliance, profile/garage usable, docs match implementation 100%, Lighthouse 95+.</snippet>
      </doc>
      <doc>
        <path>docs/design-system.md</path>
        <title>Design System Documentation</title>
        <section>Complete Design System Specification</section>
        <snippet>Documents brand colors (Red #D12026, Navy #292664, Blue #529BCA), typography (Body: Inter 400-700, Headings: Outfit 600-700), spacing (4px base unit), border radius, shadows, animation timing, WCAG AA accessibility standards. NOTE: Needs reconciliation with globals.css (actual uses Figtree).</snippet>
      </doc>
      <doc>
        <path>docs/solution-architecture.md</path>
        <title>Solution Architecture</title>
        <section>Design System Architecture</section>
        <snippet>Design tokens defined in globals.css as CSS custom properties. Components reference tokens via var(--token-name). 4px spacing grid system, shadow elevation system, border radius tokens. Reference: enthusiastauto.com for design direction.</snippet>
      </doc>
      <doc>
        <path>docs/bmm-workflow-status.md</path>
        <title>Workflow Status</title>
        <section>Epic 10 Context &amp; Priority</section>
        <snippet>Epic 10 added 2025-10-28 as PRIORITY. Critical issues: accessibility violations severity 5/5 (profile/garage unusable), typography inconsistency severity 3/5, component visual differences severity 3/5. Must complete BEFORE continuing Epic 5/6 implementation.</snippet>
      </doc>
    </docs>
    <code>
      <artifact>
        <path>app/globals.css</path>
        <kind>stylesheet</kind>
        <symbol>@theme inline</symbol>
        <lines>37-349</lines>
        <reason>Core design tokens - ALL CSS custom properties defined here. Contains font-family (Figtree line 111), typography scale (lines 110-175), color system (lines 49-95), spacing grid comments (lines 177-188), shadow elevations, border radius tokens, animation timing. Text-transform uppercase on all headings (line 335) - key inconsistency to document.</reason>
      </artifact>
      <artifact>
        <path>app/globals.css</path>
        <kind>stylesheet</kind>
        <symbol>:root and .dark theme definitions</symbol>
        <lines>237-306</lines>
        <reason>ShadCN theme variable mappings for light/dark modes. Dark mode is primary theme (line 274-306) with navy/charcoal colors. Critical for understanding background/foreground color relationships and potential profile/garage conflicts.</reason>
      </artifact>
      <artifact>
        <path>app/page.tsx</path>
        <kind>page</kind>
        <symbol>HomePage</symbol>
        <lines>1-end</lines>
        <reason>Homepage implementation - first page to audit for design token usage patterns, typography hierarchy, color application, spacing consistency.</reason>
      </artifact>
      <artifact>
        <path>app/vehicles/page.tsx</path>
        <kind>page</kind>
        <symbol>VehiclesPage</symbol>
        <lines>1-end</lines>
        <reason>Vehicle listing page - compare card styling with parts/products page to document visual inconsistencies mentioned in Story AC7.</reason>
      </artifact>
      <artifact>
        <path>app/search/page.tsx</path>
        <kind>page</kind>
        <symbol>SearchPage</symbol>
        <lines>1-end</lines>
        <reason>Unified search page - document layout issues mentioned in Story AC7, typography/color/spacing usage patterns.</reason>
      </artifact>
      <artifact>
        <path>app/account/profile/page.tsx</path>
        <kind>page</kind>
        <symbol>ProfilePage</symbol>
        <lines>1-end</lines>
        <reason>CRITICAL - Profile page with severity 5/5 color conflicts (identical bg/text colors making page unusable). Primary target for accessibility audit.</reason>
      </artifact>
      <artifact>
        <path>app/account/garage/page.tsx</path>
        <kind>page</kind>
        <symbol>GaragePage</symbol>
        <lines>1-end</lines>
        <reason>CRITICAL - Garage page with severity 5/5 color conflicts (identical bg/text colors making page unusable). Primary target for accessibility audit.</reason>
      </artifact>
      <artifact>
        <path>app/services/page.tsx</path>
        <kind>page</kind>
        <symbol>ServicesPage</symbol>
        <lines>1-end</lines>
        <reason>Services page - verify design token usage consistency with other pages, document typography/color/spacing patterns.</reason>
      </artifact>
      <artifact>
        <path>components/product-card.tsx</path>
        <kind>component</kind>
        <symbol>ProductCard</symbol>
        <lines>1-end</lines>
        <reason>Product/parts card component - compare visual styling with VehicleCard to document dramatic differences mentioned in Story AC7 (component visual inconsistencies severity 3/5).</reason>
      </artifact>
      <artifact>
        <path>components/vehicles/VehicleCard.tsx</path>
        <kind>component</kind>
        <symbol>VehicleCard</symbol>
        <lines>1-end</lines>
        <reason>Vehicle card component - compare with ProductCard to document visual differences (padding, layout, styling). Key artifact for AC7 component inconsistency analysis.</reason>
      </artifact>
      <artifact>
        <path>components/ui/card.tsx</path>
        <kind>component</kind>
        <symbol>Card (ShadCN)</symbol>
        <lines>1-end</lines>
        <reason>Base ShadCN Card component - understand foundation card styling that ProductCard and VehicleCard should extend consistently.</reason>
      </artifact>
      <artifact>
        <path>components/ui/button.tsx</path>
        <kind>component</kind>
        <symbol>Button (ShadCN)</symbol>
        <lines>1-end</lines>
        <reason>Base button component using design tokens - verify consistent usage of var(--) tokens vs hardcoded values.</reason>
      </artifact>
      <artifact>
        <path>components/ui/badge.tsx</path>
        <kind>component</kind>
        <symbol>Badge (ShadCN)</symbol>
        <lines>1-end</lines>
        <reason>Badge component for semantic colors - verify success/warning/error color usage and accessibility contrast ratios.</reason>
      </artifact>
      <artifact>
        <path>docs/design-system.md</path>
        <kind>documentation</kind>
        <symbol>Design System Spec</symbol>
        <lines>1-93</lines>
        <reason>PRIMARY DOCUMENTATION TO SYNC - Documents Inter/Outfit fonts (lines 22-23) but implementation uses Figtree (globals.css line 111). Must reconcile and update to match chosen implementation.</reason>
      </artifact>
    </code>
    <dependencies>
      <node>
        <package name="tailwindcss" version="^4.0.9" />
        <package name="@tailwindcss/typography" version="^0.5.16" />
        <package name="@tailwindcss/container-queries" version="^0.1.1" />
        <package name="tailwindcss-animate" version="^1.0.7" />
        <package name="next" version="^15.1.6" />
        <package name="react" version="^19.0.0" />
        <package name="@radix-ui/react-*" note="ShadCN UI components built on Radix primitives" />
      </node>
      <fonts>
        <package name="Figtree" source="Google Fonts" note="Currently used in globals.css line 111, conflicts with design-system.md which specifies Inter/Outfit" />
      </fonts>
    </dependencies>
  </artifacts>

  <constraints>
    <constraint priority="critical">All pages MUST meet WCAG 2.1 AA standards: 4.5:1 minimum contrast for text, 3:1 for UI components (NFR011)</constraint>
    <constraint priority="critical">Profile and garage pages have SEVERITY 5/5 color conflicts - identical background/text colors making them unusable. This is the highest priority fix for Story 10.3.</constraint>
    <constraint priority="high">Font family decision required: Keep Figtree (current implementation) OR switch to Inter/Outfit (documented spec). Decision must be made and documented with rationale.</constraint>
    <constraint priority="high">All headings have text-transform: uppercase applied (globals.css line 335). Evaluate if this is desired behavior or should be removed/made optional.</constraint>
    <constraint priority="medium">Component visual consistency: Parts cards vs vehicle cards have dramatic visual differences (padding, layout, styling). Document specific differences for Story 10.4.</constraint>
    <constraint priority="medium">Design-system.md documentation must be updated to 100% match chosen implementation - zero discrepancies allowed after this story.</constraint>
    <constraint priority="low">Search page has layout issues to document. Parts display has extra section that doesn't match design.</constraint>
    <constraint type="architecture">All design tokens defined in globals.css @theme inline directive (lines 37-235). Components should use var(--token-name) syntax, not hardcoded values.</constraint>
    <constraint type="architecture">4px spacing grid system documented in comments (lines 177-188). Linear-inspired tight spacing patterns.</constraint>
    <constraint type="architecture">Typography scale uses Linear system with paired font-size/line-height/letter-spacing values (lines 110-175).</constraint>
    <constraint type="architecture">Shadow elevation system: --shadow-tiny, --shadow-low, --shadow-medium, --shadow-high (lines 97-101).</constraint>
    <constraint type="architecture">Border radius tokens: --radius-4 through --radius-32 and --radius-full (lines 38-47).</constraint>
    <constraint type="testing">All color combinations must be tested with automated tools (Lighthouse, axe DevTools) AND manual verification.</constraint>
    <constraint type="testing">Profile and garage pages require manual usability testing to verify fixes in Story 10.3.</constraint>
    <constraint type="documentation">Design-system.md accuracy must be validated against implementation - create validation checklist.</constraint>
  </constraints>
  <interfaces>
    <interface>
      <name>CSS Custom Properties (Design Tokens)</name>
      <kind>CSS Variables</kind>
      <signature>var(--token-name)</signature>
      <path>app/globals.css:37-235</path>
      <description>All design tokens accessible via CSS custom properties. Components should reference tokens using var(--color-text-primary), var(--font-size-base), var(--spacing-4), etc. Never hardcode values.</description>
    </interface>
    <interface>
      <name>ShadCN Theme System</name>
      <kind>CSS Variables</kind>
      <signature>:root and .dark theme definitions</signature>
      <path>app/globals.css:237-306</path>
      <description>ShadCN semantic colors mapped to design tokens: --background, --foreground, --card, --primary, --secondary, --muted, --accent, --destructive, --border. Dark mode is primary theme.</description>
    </interface>
    <interface>
      <name>Tailwind Design Token Classes</name>
      <kind>Utility Classes</kind>
      <signature>className="text-foreground bg-background"</signature>
      <path>Tailwind CSS v4</path>
      <description>Tailwind utilities reference CSS custom properties. Use semantic classes (text-foreground, bg-card, border-border) instead of hardcoded colors.</description>
    </interface>
    <interface>
      <name>Page Component Pattern</name>
      <kind>React Server Component</kind>
      <signature>export default async function PageName()</signature>
      <path>app/**/page.tsx</path>
      <description>All pages are React Server Components. Audit should examine rendered HTML and applied styles, not just component code.</description>
    </interface>
  </interfaces>
  <tests>
    <standards>This is a documentation/audit story with testing focused on validation and analysis rather than code testing. Standards for audit validation: (1) Use automated accessibility tools (Lighthouse, axe DevTools, WAVE) to test WCAG 2.1 AA compliance on all 7 pages. (2) Manual color contrast testing with WebAIM contrast checker - verify 4.5:1 minimum for text, 3:1 for UI components. (3) Visual regression testing by capturing screenshots of all pages for comparison. (4) Document validation: Create checklist comparing every design-system.md specification against globals.css implementation. (5) Token usage analysis: Grep codebase for hardcoded color/font/spacing values vs var(--) token usage. (6) Component comparison: Side-by-side visual inspection of ProductCard vs VehicleCard implementations.</standards>
    <locations>
      <location>app/page.tsx - Homepage audit</location>
      <location>app/vehicles/page.tsx - Vehicle listing audit</location>
      <location>app/search/page.tsx - Search page audit</location>
      <location>app/account/profile/page.tsx - Profile page CRITICAL audit</location>
      <location>app/account/garage/page.tsx - Garage page CRITICAL audit</location>
      <location>app/services/page.tsx - Services page audit</location>
      <location>app/globals.css - Design token inventory</location>
      <location>docs/design-system.md - Documentation validation</location>
      <location>components/product-card.tsx - Component comparison</location>
      <location>components/vehicles/VehicleCard.tsx - Component comparison</location>
    </locations>
    <ideas>
      <test-idea ac="1">Audit homepage (/) - document all typography usage (h1-h6, body text, labels), color usage (backgrounds, text, borders), spacing patterns (margins, padding, gaps)</test-idea>
      <test-idea ac="1">Audit products/parts page - compare card styling with vehicle cards, document typography/color/spacing</test-idea>
      <test-idea ac="1">Audit vehicles page - compare with products page for consistency, document visual differences</test-idea>
      <test-idea ac="1">Audit search page - identify layout issues mentioned in story, document typography/color/spacing</test-idea>
      <test-idea ac="1">Audit profile page (CRITICAL) - document color conflicts (bg/text identical), typography, spacing</test-idea>
      <test-idea ac="1">Audit garage page (CRITICAL) - document color conflicts (bg/text identical), typography, spacing</test-idea>
      <test-idea ac="1">Audit services page - verify consistency with other pages, document patterns</test-idea>
      <test-idea ac="1">Screenshot all 7 pages for visual reference and comparison</test-idea>
      <test-idea ac="2">Grep codebase for hardcoded color values (hex codes, rgb) vs var(--color-*) usage</test-idea>
      <test-idea ac="2">Grep codebase for hardcoded font-size values vs var(--font-size-*) usage</test-idea>
      <test-idea ac="2">Grep codebase for hardcoded spacing values vs Tailwind spacing classes</test-idea>
      <test-idea ac="2">Identify pages using text-transform: uppercase and evaluate if desired</test-idea>
      <test-idea ac="2">Document all instances where components don't use design tokens</test-idea>
      <test-idea ac="3">Run Lighthouse accessibility audit on all 7 pages - target 95+ score</test-idea>
      <test-idea ac="3">Run axe DevTools on all pages - identify all WCAG violations with severity</test-idea>
      <test-idea ac="3">Test profile page text/background contrast ratios - document CRITICAL failures</test-idea>
      <test-idea ac="3">Test garage page text/background contrast ratios - document CRITICAL failures</test-idea>
      <test-idea ac="3">Test all interactive elements (buttons, links, inputs) for 3:1 minimum contrast</test-idea>
      <test-idea ac="3">Test hover, focus, active states for sufficient contrast on all pages</test-idea>
      <test-idea ac="3">Create violations report with severity ratings (1-5) and WCAG level (A, AA, AAA)</test-idea>
      <test-idea ac="4">Compare design-system.md font specification (Inter/Outfit) vs globals.css (Figtree)</test-idea>
      <test-idea ac="4">Compare design-system.md color palette vs globals.css color tokens</test-idea>
      <test-idea ac="4">Compare design-system.md spacing system vs globals.css spacing scale</test-idea>
      <test-idea ac="4">Compare design-system.md shadow elevations vs globals.css shadow tokens</test-idea>
      <test-idea ac="4">Make font family decision: Keep Figtree (current) or switch to Inter/Outfit (docs). Document rationale considering: brand consistency with enthusiastauto.com, readability, accessibility, implementation effort.</test-idea>
      <test-idea ac="5">Update design-system.md typography section with chosen font family</test-idea>
      <test-idea ac="5">Update design-system.md color palette to exactly match globals.css</test-idea>
      <test-idea ac="5">Update design-system.md spacing system to match implementation</test-idea>
      <test-idea ac="5">Validate 100% accuracy between updated docs and implementation</test-idea>
      <test-idea ac="6">Create design token usage matrix: 7 pages (rows) × token categories (columns: typography, colors, spacing, shadows, radius)</test-idea>
      <test-idea ac="6">Mark which pages correctly use tokens vs hardcoded values</test-idea>
      <test-idea ac="6">Calculate consistency score per page (percentage of correct token usage)</test-idea>
      <test-idea ac="6">Identify pages with highest drift from design system</test-idea>
      <test-idea ac="7">Compare ProductCard vs VehicleCard - document padding differences</test-idea>
      <test-idea ac="7">Compare ProductCard vs VehicleCard - document layout structure differences</test-idea>
      <test-idea ac="7">Compare ProductCard vs VehicleCard - document color/typography differences</test-idea>
      <test-idea ac="7">Document profile page color conflicts with specific examples (which elements, which colors)</test-idea>
      <test-idea ac="7">Document garage page color conflicts with specific examples</test-idea>
      <test-idea ac="7">Document search page layout issues with screenshots</test-idea>
      <test-idea ac="7">Document parts display extra section issue</test-idea>
      <test-idea ac="8">Story 10.2 (Typography) recommendations - list all typography fixes needed with effort estimates</test-idea>
      <test-idea ac="8">Story 10.3 (Color/Accessibility) recommendations - prioritize CRITICAL fixes (profile/garage) with effort estimates</test-idea>
      <test-idea ac="8">Story 10.4 (Components) recommendations - list component unification needs (cards, buttons, badges) with effort estimates</test-idea>
      <test-idea ac="8">Story 10.5 (Layout/Spacing) recommendations - list layout/spacing fixes with effort estimates</test-idea>
      <test-idea ac="8">Create implementation sequence for Epic 10 stories based on dependencies and severity</test-idea>
    </ideas>
  </tests>
</story-context>
